---
title: "Interactive_Vaccines"
author: "Ryan Johnson"
date: "8/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(tidyverse)
library(ggiraph)
library(patchwork)
```

## R Markdown

```{r}
data_url <- "https://github.com/owid/covid-19-data/raw/master/public/data/vaccinations/us_state_vaccinations.csv"

all_data <- read.csv(data_url)
all_data$location[all_data$location == "New York State"] <- "New York"
```

```{r}
not_states_or_dc <- c("American Samoa", "Bureau of Prisons", 
  "Dept of Defense", "Federated States of Micronesia", "Guam", 
  "Indian Health Svc", "Long Term Care", "Marshall Islands", 
  "Northern Mariana Islands", "Puerto Rico", "Republic of Palau", 
  "United States", "Veterans Health", "Virgin Islands")
```

```{r}
max_date <- all_data %>%
  pull(date) %>%
  max()
bar_graph_data_recent <- all_data %>%  
  filter(date == max_date, !(location %in% not_states_or_dc)) %>%
  rename(State = location) %>%
  mutate(
   PctFullyVaccinated = round(people_fully_vaccinated_per_hundred, 1),
   tooltip_text = paste0(toupper(State), "\n", 
                   PctFullyVaccinated, "%")
  ) %>%  
  select(State, PctFullyVaccinated, tooltip_text)
```


```{r}
latest_vax_graph <- ggplot(bar_graph_data_recent, 
                aes(x = reorder(State, PctFullyVaccinated), 
                    y = PctFullyVaccinated,
                    tooltip = tooltip_text, data_id = State #<<
                    )) +
  geom_col_interactive(color = "black", fill="#0072B2", size = 0.5) +  #<<
  theme_minimal() +
  theme(axis.text=element_text(size = 6)) +  #<<
  labs(title = str_glue("Percent Fully Vaccinated ", format.Date(max_date, "%B %d, %Y")),
       subtitle = "Data from Our World in Data GitHub repo"
       ) +
   ylab("") +
   xlab("") +
  coord_flip() +
  scale_y_continuous(limits = c(0,100))

#girafe(ggobj = latest_vax_graph, width_svg = 5, height_svg = 4)
```

```{r}
library(albersusa)
us_sf <- usa_sf("lcc") %>%
  mutate(State = as.character(name))

state_map <- ggplot() +
  geom_sf_interactive(data = us_sf, size = 0.125, 
                      aes(data_id = State, tooltip = State)) +
  theme_void()
```

```{r}
girafe(ggobj = state_map + latest_vax_graph, 
       width_svg = 10, height_svg = 5) %>%
  girafe_options(opts_hover(css = "fill:cyan;"))
```

