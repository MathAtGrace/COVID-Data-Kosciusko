---
output:
  pdf_document: default
  html_notebook: default
---


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
require(tidyverse)
library(googlesheets4)
library(dplyr)
library(ggplot2)
library(readxl)
library(httr)
library(scales)
library(zoo)

#IN_pos
IN_pos = 6.8
#Kos_pos
Kos_pos = 15.8

#Kosciusko Data
url = "https://hub.mph.in.gov/dataset/bd08cdd3-9ab1-4d70-b933-41f9ef7b809d/resource/afaa225d-ac4e-4e80-9190-f6800c366b58/download/covid_report_county_date.xlsx"
GET(url, write_disk(tf <- tempfile(fileext = ".xlsx")))
df <- read_excel(tf)
K <- subset(df, df$COUNTY_NAME == "Kosciusko")
K$DATE <- as.Date(K$DATE)

url3 = "https://hub.mph.in.gov/dataset/07e12c46-eb38-43cf-b9e1-46a9c305beaa/resource/9ae4b185-b81d-40d5-aee2-f0e30405c162/download/covid_report_demographics_county_district.xlsx"
GET(url3, write_disk(tf <- tempfile(fileext = ".xlsx")))
df <- read_excel(tf)
K2 <- subset(df, df$county_name == "Kosciusko")
K$DATE <- as.Date(K$DATE)

#Indiana Data
url2 = "https://hub.mph.in.gov/dataset/ab9d97ab-84e3-4c19-97f8-af045ee51882/resource/182b6742-edac-442d-8eeb-62f96b17773e/download/covid_report_date.xlsx"
GET(url2, write_disk(tf <- tempfile(fileext = ".xlsx")))
I <- read_excel(tf)
I$DATE <- as.Date(I$DATE)

#Student Data
S <- read_sheet("https://docs.google.com/spreadsheets/d/1hYSSaiyIbV_pjBs3ljTwF9kf5YI0Ewj_bNEt7tNYMtA/edit#gid=0", col_types = "cDDDDDDcDccccc", col_names = c("Location", "Travel_Quarantine", "Exporsure Date", "Exposure_Quarantine", "Isolated", "Test_Date", "Result_Date", "Test_Result", "End_Date", "RD_RA", "Athlete", "Meals", "Complete", "Notes"), skip = 1)

#Employee Data
E <- read_sheet("https://docs.google.com/spreadsheets/d/1M1rKYVYg8bGqYlHjmh51XRNK4JLY5TjMPbrw9_OUaFE/edit#gid=0", col_types = "DDDDcDDDcnc", col_names = c("Quarantine", "Isolated", "Test_Date", "Result_Date", "Test_Result", "Earliest", "End_Date", "Return_Date", "Work_Home", "Days_Off", "Complete"), skip = 1)

#Don't count quarantines that are dated after isolation
#First for E
QafterI <- E$Quarantine > E$Isolated
QafterI[is.na(QafterI)] <- FALSE
E[QafterI,]$Quarantine <- NA
#Then for S
Q2afterI <- min(S$Travel_Quarantine, S$Exposure_Quarantine, na.rm = TRUE) > S$Isolated
Q2afterI[is.na(Q2afterI)] <- FALSE
S[Q2afterI,]$Travel_Quarantine <- NA
S[Q2afterI,]$Exposure_Quarantine <- NA

#COVID Test results without test dates corrected to isolation dates
E$TND <- !is.na(E$Test_Result) & is.na(E$Test_Date)
S$TND <- !is.na(S$Test_Result) & is.na(S$Test_Date)
E[E$TND,]$Test_Date <- E[E$TND,]$Isolated
S[S$TND,]$Test_Date <- S[S$TND,]$Isolated

#Keep Track of Isolations that happen after Quarantine
#First for E
E$Iso_After_Quar <- !is.na(E$Isolated) &
  (!is.na(E$Quarantine) & E$Isolated > E$Quarantine)
#Then for S
S$Iso_After_TQuar <- !is.na(S$Isolated) &
  (!is.na(S$Travel_Quarantine) & S$Isolated > S$Travel_Quarantine)
S$Iso_After_EQuar <- !is.na(S$Isolated) &
  (!is.na(S$Exposure_Quarantine) & S$Isolated > S$Exposure_Quarantine)
S$Iso_After_Quar <- S$Iso_After_TQuar | S$Iso_After_EQuar

#Is the student at home?
S$At_Home <- 
  (tolower(substring(S$Location, 1, 4)) == "home") |
  (tolower(substring(S$Location, 1, 4)) == "off ") |
  (tolower(substring(S$Location, 1, 4)) == "fami")
S[is.na(S$At_Home),]$At_Home <- FALSE
S$Location <- if(S$At_Home){
  "Home"
}else{
  "Grace"
}

#Keep Track of Quarantines that end without Isoloation
#First for E
E$End_Q <- !is.na(E$Quarantine) & is.na(E$Isolated) & !is.na(E$Complete)
#Then for S
S$End_TQ <- !is.na(S$Travel_Quarantine) & is.na(S$Isolated) & !is.na(S$Complete)
S$End_EQG <- !is.na(S$Exposure_Quarantine) &
  is.na(S$Isolated) &
  !is.na(S$Complete) &
  !S$At_Home
S$End_EQH <- !is.na(S$Exposure_Quarantine) &
  is.na(S$Isolated) &
  !is.na(S$Complete) &
  S$At_Home

#Keep Track of Isolations that end
E$End_I <- !is.na(E$Isolated) & !is.na(E$Complete)
S$End_I <- !is.na(S$Isolated) & !is.na(S$Complete)

#Keep Track of Tested Cases that End
E$End_C <- !is.na(E$Test_Date) & !is.na(E$Complete)
S$End_C <- !is.na(S$Test_Date) & !is.na(S$Complete)

#Fix missing end dates for E if a return to work date exists
E$fix_end_date <- is.na(E$End_Date) & !is.na(E$Return_Date)
E[E$fix_end_date,]$End_Date <- E[E$fix_end_date,]$Return_Date

#Fix different ways of entering positives and negatives
S$Test_Result <- tolower(substring(S$Test_Result, 1, 1))
E$Test_Result <- tolower(substring(E$Test_Result, 1, 1))

#The first day of data
first_S <- min(S$Travel_Quarantine, na.rm = TRUE)
first_E <- min(E$Quarantine, na.rm = TRUE)
yest <- Sys.Date()-1

#Count data from E by day
E2 <- data.frame(Date = seq(first_E, yest, by="days"))
#First Quarentine
E2$New_Q <- 
    sapply(E2$Date, function(x)
      sum(E$Quarantine == x, na.rm = TRUE))
E2$Tot_Q <- cumsum(E2$New_Q)
E2$New_QtoI <-
  sapply(E2$Date, function(x)
    sum(E[E$Iso_After_Quar,]$Isolated == x, na.rm = TRUE))
E2$Tot_QtoI <- cumsum(E2$New_QtoI)
E2$New_End_Q <-
  sapply(E2$Date, function(x)
    sum(E[E$End_Q,]$End_Date == x, na.rm = TRUE))
E2$Tot_End_Q <- cumsum(E2$New_End_Q)
E2$Cur_Q <- E2$Tot_Q - E2$Tot_QtoI - E2$Tot_End_Q
#Next Isolation
E2$New_Iso <-
    sapply(E2$Date, function(x)
      sum(E$Isolated == x, na.rm = TRUE))
E2$Tot_Iso <- cumsum(E2$New_Iso)
E2$New_End_I <-
  sapply(E2$Date, function(x)
    sum(E[E$End_I,]$End_Date == x, na.rm = TRUE))
E2$Tot_End_I <- cumsum(E2$New_End_I)
E2$Cur_I <- E2$Tot_Iso - E2$Tot_End_I
#Next Confirmed Cases
E2$New_Cases<-
  sapply(E2$Date, function(x)
    sum(E[E$Test_Result == "p",]$Test_Date == x, na.rm = TRUE))
E2$Tot_Cases <- cumsum(E2$New_Cases)
E2$New_End_Cases <-
  sapply(E2$Date, function(x)
    sum(E[E$Test_Result == "p",]$End_C == x, na.rm = TRUE))
E2$Tot_Ended_Cases <- cumsum(E2$New_End_Cases)
E2$Cur_Cases <- E2$Tot_Cases - E2$Tot_Ended_Cases

#Count data from S by day
S2 <- data.frame(Date = seq(first_S, yest, by="days"))
SG = subset(S, !At_Home)
SH = subset(S, At_Home)
S2$New_Iso_G <-
    sapply(S2$Date, function(x)
      sum(SG$Isolated == x, na.rm = TRUE))
S2$Tot_Iso_G <- cumsum(S2$New_Iso_G)
S2$New_Iso_H <-
    sapply(S2$Date, function(x)
      sum(SH$Isolated == x, na.rm = TRUE))
S2$Tot_Iso_H <- cumsum(S2$New_Iso_H)
S2$New_TQ <- 
    sapply(S2$Date, function(x)
      sum(S$Travel_Quarantine == x, na.rm = TRUE))
S2$Tot_TQ <- cumsum(S2$New_TQ)
S2$New_EQ_G <- 
    sapply(S2$Date, function(x)
      sum(SG$Exposure_Quarantine == x, na.rm = TRUE))
S2$Tot_EQ_G <- cumsum(S2$New_EQ_G)
S2$New_EQ_H <- 
    sapply(S2$Date, function(x)
      sum(SH$Exposure_Quarantine == x, na.rm = TRUE))
S2$Tot_EQ_H <- cumsum(S2$New_EQ_H)
S2$New_Q <- S2$New_TQ + S2$New_EQ_G + S2$New_EQ_H
S2$Tot_Q <- S2$Tot_TQ + S2$Tot_EQ_G + S2$Tot_EQ_H
S2$New_TQtoI <-
  sapply(S2$Date, function(x)
      sum(S[S$Iso_After_TQuar,]$Isolated == x, na.rm = TRUE))
S2$Tot_TQtoI <- cumsum(S2$New_TQtoI)
S2$New_EQGtoI <-
  sapply(S2$Date, function(x)
      sum(SG[SG$Iso_After_EQuar,]$Isolated == x, na.rm = TRUE))
S2$Tot_EQGtoI <- cumsum(S2$New_EQGtoI)
S2$New_EQHtoI <-
  sapply(S2$Date, function(x)
      sum(SH[SH$Iso_After_EQuar,]$Isolated == x, na.rm = TRUE))
S2$Tot_EQHtoI <- cumsum(S2$New_EQHtoI)
S2$New_QtoI <- S2$New_TQtoI + S2$New_EQGtoI + S2$New_EQHtoI
S2$Tot_QtoI <- S2$Tot_TQtoI + S2$Tot_EQGtoI + S2$Tot_EQHtoI
S2$New_End_TQ <-
  sapply(S2$Date, function(x)
    sum(S[S$End_TQ,]$End_Date == x, na.rm = TRUE))
S2$Tot_End_TQ <- cumsum(S2$New_End_TQ)
S2$New_End_EQG <-
  sapply(S2$Date, function(x)
    sum(SG[SG$End_EQ,]$End_Date == x, na.rm = TRUE))
S2$Tot_End_EQG <- cumsum(S2$New_End_EQG)
S2$New_End_EQH <-
  sapply(S2$Date, function(x)
    sum(SH[SH$End_EQ,]$End_Date == x, na.rm = TRUE))
S2$Tot_End_EQH <- cumsum(S2$New_End_EQH)
S2$New_End_IG <-
  sapply(S2$Date, function(x)
    sum(SG[SG$End_I,]$End_Date == x, na.rm = TRUE))
S2$Tot_End_IG <- cumsum(S2$New_End_IG)
S2$New_End_IH <-
  sapply(S2$Date, function(x)
    sum(SH[SH$End_I,]$End_Date == x, na.rm = TRUE))
S2$Tot_End_IH <- cumsum(S2$New_End_IH)
S2$Cur_TQ <- S2$Tot_TQ - S2$Tot_TQtoI - S2$Tot_End_TQ
S2$Cur_EQG <- S2$Tot_EQ_G - S2$Tot_EQGtoI - S2$Tot_End_EQG
S2$Cur_EQH <- S2$Tot_EQ_H - S2$Tot_EQHtoI - S2$Tot_End_EQH
S2$Cur_Q <- S2$Cur_TQ + S2$Cur_EQG + S2$Cur_EQH
S2$Cur_IG <- S2$Tot_Iso_G - S2$Tot_End_IG
S2$Cur_IH <- S2$Tot_Iso_H - S2$Tot_End_IH
#New Confirmed Cases
S2$New_Cases_G<-
  sapply(S2$Date, function(x)
    sum(SG[SG$Test_Result == "p",]$Test_Date == x, na.rm = TRUE))
S2$Tot_Cases_G <- cumsum(S2$New_Cases_G)
S2$New_Cases_H<-
  sapply(S2$Date, function(x)
    sum(SH[SH$Test_Result == "p",]$Test_Date == x, na.rm = TRUE))
S2$Tot_Cases_H <- cumsum(S2$New_Cases_H)
S2$New_End_Cases_G <-
  sapply(S2$Date, function(x)
    sum(SG[SG$Test_Result == "p",]$End_C == x, na.rm = TRUE))
S2$Tot_Ended_Cases_G <- cumsum(S2$New_End_Cases_G)
S2$New_End_Cases_H <-
  sapply(S2$Date, function(x)
    sum(SH[SH$Test_Result == "p",]$End_C == x, na.rm = TRUE))
S2$Tot_Ended_Cases_H <- cumsum(S2$New_End_Cases_H)
S2$Cur_Cases_G <- S2$Tot_Cases_G - S2$Tot_Ended_Cases_G
S2$Cur_Cases_H <- S2$Tot_Cases_H - S2$Tot_Ended_Cases_H

#A Dataframe that is easier to display stacked lines (No longer used?)
#SQ <- rbind(data.frame(Date = S2$Date, Q = S2$Cur_TQ, Type = "Travel"),
#            data.frame(Date = S2$Date, Q = S2$Cur_EQ, Type = "Exposure"))

#A Dataframe that makes it easier to stack home/grace lines
SGH <- rbind(data.frame(Date = S2$Date,
                        Cur_Cases = S2$Cur_Cases_G,
                        Cur_I = S2$Cur_IG,
                        Cur_Q = S2$Cur_EQG,
                        Location = "Grace"),
             data.frame(Date = S2$Date,
                        Cur_Cases = S2$Cur_Cases_H,
                        Cur_I = S2$Cur_IH,
                        Cur_Q = S2$Cur_EQH,
                        Location = "Home"))

#The length of the data frames.  Useful for picking out the most recent obersvation.
nS = nrow(S2)
nE = nrow(E2)
```

![Grace Logo](Logo-GC-Red-Background-Stretched.jpg)\

<center>
# Grace College Internal COVID-19 Data
## Compiled by Dr. Ryan Johnson using contact tracing data from Laura Green and testing data from the state of Indiana.
### Last updated `r format(Sys.time(), '%A, %B %d, %Y, at %I:%M%p')`
</center>

\newpage

# Cases

In the graphs below, confirmed cases are matched to the date the test was taken, not the date of the test result.  Thus, **be careful** making inferences based on the most recent 2-4 days, because those numbers might go up as tests come back.


### Confirmed Cases Among Students

Grace College has

* `r S2$Cur_Cases_G[[nS]]` current confirmed cases among students at Grace.
* `r S2$Tot_Cases_G[[nS]]` total confirmed cases among students at Grace.
* `r S2$Cur_Cases_H[[nS]]` current confirmed cases among students at Home.
* `r S2$Tot_Cases_H[[nS]]` total confirmed cases among students at Home.

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(SGH, aes(x = Date, y = Cur_Cases, fill = Location)) + 
  geom_histogram(binwidth = 1,stat = "identity", stackgroups = TRUE) +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="2 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), breaks = pretty_breaks()) +
  ggtitle("Active Confirmed Cases Among Students Each Day") + 
  theme(plot.title = element_text(hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Students") + 
  xlab("Date") +
  geom_vline(xintercept = as.Date("2020-08-01"))
```

### Confirmed Cases Among Employees

Grace College has

* `r E2$Cur_Cases[[nE]]` current confirmed cases among the employees.
* `r E2$Tot_Cases[[nE]]` total confirmed cases among the employees.

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(E2, aes(x = Date, y = Cur_Cases)) + 
  geom_histogram(binwidth = 1,stat = "identity") +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="4 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), breaks = function(x) unique(floor(pretty(seq(0, (max(x) + 1) * 1.1))))) +
  ggtitle("Active Confirmed Cases Among Employees Each Day") + 
  theme(plot.title = element_text(hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Employees") + 
  xlab("Date") +
  geom_vline(xintercept = as.Date("2020-07-01")) +
  geom_vline(xintercept = as.Date("2020-08-01"))
```

\newpage

# Isolated

### Isolated Students

Grace College has

* `r S2$Cur_IG[[nS]]` current isolated students at Grace.
* `r S2$Tot_Iso_G[[nS]]` total isolated students at Grace.  It theoretically possible for a student to be isolated more than once if they test negative the first time.
* `r S2$Cur_IH[[nS]]` current isolated students at Home.
* `r S2$Tot_Iso_H[[nS]]` total isolated students at Home.  It theoretically possible for a student to be isolated more than once if they test negative the first time.

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(SGH, aes(x = Date, y = Cur_I, fill = Location)) + 
  geom_histogram(binwidth = 1,stat = "identity", stackgroups = TRUE) +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="2 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), breaks = pretty_breaks()) +
  ggtitle("Isolated Students Each Day") + 
  theme(plot.title = element_text(hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Students") + 
  xlab("Date") +
  geom_vline(xintercept = as.Date("2020-08-01"))
```

### Isolated Employees

Grace College has

* `r E2$Cur_I[[nE]]` current isolated employees.
* `r E2$Tot_I[[nE]]` total isolated employees. It theoretically possible for an employee to be isolated more than once if they test negative the first time.

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(E2, aes(x = Date, y = Cur_I)) + 
  geom_histogram(binwidth = 1,stat = "identity") +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="4 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), breaks = pretty_breaks()) +
  ggtitle("Isolated Employees Each Day") + 
  theme(plot.title = element_text(hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Employees") + 
  xlab("Date") +
  geom_vline(xintercept = as.Date("2020-07-01")) +
  geom_vline(xintercept = as.Date("2020-08-01"))
```

\newpage

# Quarantined

### Quarantined Students

Grace College has

* `r S2$Cur_EQG[[nS]]` current quarantined students at Grace because of exposure.
* `r S2$Tot_EQ_G[[nS]]` total quarantined students at Grace because of exposure.  It theoretically possible for a student to be quarantined more than once if they do not show symptoms first time.
* `r S2$Cur_EQH[[nS]]` current quarantined students at Home because of exposure.
* `r S2$Tot_EQ_H[[nS]]` total quarantined students at Home because of exposure.  It theoretically possible for a student to be quarantined more than once if they do not show symptoms first time.

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(SGH, aes(x = Date, y = Cur_Q, fill = Location)) + 
  geom_histogram(binwidth = 1,stat = "identity", stackgroups = TRUE) +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="2 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), breaks = pretty_breaks()) +
  ggtitle("Current Students In Quarantine from Exposure Each Day") + 
  theme(plot.title = element_text(hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Students") + 
  xlab("Date") +
  geom_vline(xintercept = as.Date("2020-08-01"))
```

### Quarantined Employees

Grace College has

* `r E2$Cur_Q[[nE]]` current quarantined employees.
* `r E2$Tot_Q[[nE]]` total quarantined employees.  It theoretically possible for an employee to be quarantined more than once if they do not show symptoms first time.

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(E2, aes(x = Date, y = Cur_Q)) + 
  geom_histogram(binwidth = 1,stat = "identity") +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="4 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), breaks = pretty_breaks()) +
  ggtitle("Current Quarantined Employees Each Day") + 
  theme(plot.title = element_text(hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Employees") + 
  xlab("Date") +
  geom_vline(xintercept = as.Date("2020-07-01")) +
  geom_vline(xintercept = as.Date("2020-08-01"))
```

```{r, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
#Input parameters
data_start = as.Date("2020-05-08") #Start data at this day

K$CC7 <- c(rep(0,6), rollmean(K$COVID_COUNT, 7))
K$CT7 <- c(rep(0,6), rollmean(K$COVID_TEST, 7))
K$CCT <- c(rep(0,4), rollsum(K$COVID_COUNT, 7), rep(0,2))
K$CTT <- c(rep(0,6), rollsum(K$COVID_TEST, 7))

nK2 = nrow(K)
K$TEST_RATE <- K$CCT / K$CTT
K$TEST_RATE <- c(rep(NA, 3), K$TEST_RATE[seq(-nK2, length.out = 3)])

K <- subset(K, DATE > data_start)
nK = nrow(K)

I$CC7 <- c(rep(0,6), rollmean(I$COVID_COUNT, 7))
I$CT7 <- c(rep(0,6), rollmean(I$COVID_TEST, 7))
I$CCT <- c(rep(0,4), rollsum(I$COVID_COUNT, 7), c(rep(0,2)))
I$CTT <- c(rep(0,6), rollsum(I$COVID_TEST, 7))

nI2 = nrow(I)
I$TEST_RATE <- I$CC7 / I$CT7
I$TEST_RATE <- c(rep(NA, 3), I$TEST_RATE[seq(-nI2, length.out = 3)])

I <- subset(I, DATE > data_start)
nI = nrow(I)

weekspan <- 3*7/(as.numeric(yest) - as.numeric(data_start)+2)
```

\newpage

# Kosciusko County
Kosciusko County has had

* `r round(K$CC7[[nK]], digits = 1)` cases per day the past week.
* `r sum(K$COVID_COUNT)` total confirmed cases.

### Cases - Kosciusko

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(K, aes(x = DATE, y = COVID_COUNT)) + 
  geom_point(size = 4) +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="5 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), oob = squish) +
  ggtitle("Kosciusko New Confirmed Cases") + 
  theme(plot.title = element_text(size= 20, hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("New Cases") + 
  xlab("Date") +
  stat_smooth(size = 1, se = FALSE, linetype = "dashed", span = 5/3*weekspan) +
  geom_vline(xintercept = as.Date("2020-06-01")) +
  geom_vline(xintercept = as.Date("2020-07-01"))  +   geom_vline(xintercept = as.Date("2020-08-01"))
```

### Positivity - Kosciusko

Kosciusko County has had `r Kos_pos`% 7-day positivity rate for unique indiviudals as of `r format(yest-5, "%B %d")` according to the Indiana Coronavirus Dashboard.



```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(subset(K, DATE < yest - 5), aes(x = DATE, y = TEST_RATE)) + 
  geom_point(size = 4) +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="5 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),
                     limit=c(0,NA)) +
  ggtitle("Kosciusko Percentage of Positive Tests - 7 Day Rolling Average") + 
  theme(plot.title = element_text(size= 20, hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Percent Positive") + 
  xlab("Date") +
  stat_smooth(size = 1, se = FALSE, linetype = "dashed", span = 5/3*weekspan) +
  geom_vline(xintercept = as.Date("2020-06-01")) +
  geom_vline(xintercept = as.Date("2020-07-01"))  +   geom_vline(xintercept = as.Date("2020-08-01"))
#* `r round(100 * K$TEST_RATE[[nK-5]], digits = 1)`% 7-day positivity rate as of `r format(yest-5, "%B %d")`.  This number is computed assuming an average 2-day wait for test results, and might not fit exactly with the positivity rate on the state's dashboard.
#* `r round(100 * K$TEST_RATE[[nK-5]], digits = 1)`% = `r K$CCT[[nK-8]]` / `r K$CTT[[nK-8]]`.
```

\newpage

# Indiana

The total case numbers below are multiplied by $\frac{\text{Kos pop}}{\text{Ind pop}} = \frac{79456}{6732000} = 0.01180273$, so that it is easier to compare Kosciusko numbers to the average Indiana county.

Indiana has had

* `r round(I$CC7[[nI]], digits = 1)` cases per day the past week (normalized `r round(I$CC7[[nI]]*79456/6732000, digits = 1)`).
* `r prettyNum(sum(I$COVID_COUNT),big.mark=",",scientific=FALSE)` total confirmed cases (normalized `r round(sum(I$COVID_COUNT)*79456/6732000, digits = 1)`).

### Cases - Indiana

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(I, aes(x = DATE, y = COVID_COUNT * 79456/6732000)) + 
  geom_point(size = 4) +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="5 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(limit=c(0,NA), oob = squish) +
  ggtitle("Normalized Indiana New Confirmed Cases") + 
  theme(plot.title = element_text(size= 20, hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Normalized New Cases") + 
  xlab("Date") +
  stat_smooth(size = 1, se = FALSE, linetype = "dashed", span = 5/3*weekspan) +
  geom_vline(xintercept = as.Date("2020-06-01")) +
  geom_vline(xintercept = as.Date("2020-07-01"))  +   geom_vline(xintercept = as.Date("2020-08-01"))
```

### Positivity - Indiana

Indiana has had `r IN_pos`% 7-day positivity rate for unique indiviudals as of `r format(yest-6, "%B %d")` according to the Indiana Coronavirus Dashboard..

```{r, echo=FALSE, fig.width=12, fig.height=5, message=FALSE, warning=FALSE}
ggplot(subset(I, DATE < yest - 5), aes(x = DATE, y = TEST_RATE)) + 
  geom_point(size = 4) +
  scale_x_date(date_labels="%b %d",
               date_breaks  ="5 days",
               minor_breaks = "1 day") + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),
                     limit=c(0,NA)) +
  ggtitle("Indiana Percentage of Positive Tests - 7 Day Rolling Average") + 
  theme(plot.title = element_text(size= 20, hjust = 0.5),
        legend.text = element_text(size = 15)) + 
  ylab("Percent Positive") + 
  xlab("Date") +
  stat_smooth(size = 1, se = FALSE, linetype = "dashed", span = 5/3*weekspan) +
  geom_vline(xintercept = as.Date("2020-06-01")) +
  geom_vline(xintercept = as.Date("2020-07-01"))  +   geom_vline(xintercept = as.Date("2020-08-01"))

#* `r round(100 * I$TEST_RATE[[nI-5]], digits = 1)`% 7-day positivity rate as of `r format(yest-6, "%B %d")`.  This number is computed assuming an average 2-day wait for test results, and might not fit exactly with the positivity rate on the state's dashboard.
#* `r round(100 * I$TEST_RATE[[nI-5]], digits = 1)`% = `r prettyNum(I$CCT[[nI-8]],big.mark=",",scientific=FALSE)` / `r prettyNum(I$CTT[[nI-8]], ,big.mark=",",scientific=FALSE)`.
```